// ppx
// 0.1.3
//
// Probabilistic programming execution protocol
// https://github.com/probprog/ppx
//
namespace ppx;

union MessageBody {
  Handshake,
  HandshakeResult,
  Run,
  RunResult,
  Sample,
  SampleResult,
  Observe,
  ObserveResult,
  Tag,
  TagResult,
  Forward,
  ForwardResult,
  Backward,
  BackwardResult,
  BatchOperation,
  BatchOperationResult,
  Reset
}

table Message {
  body: MessageBody;
}

table Tensor {
  data: [double];
  shape: [int];
}

union Distribution {
  Normal,
  Uniform,
  Categorical,
  Poisson
}

table Handshake {
  system_name: string;
}

table HandshakeResult {
  system_name: string;
  model_name: string;
}

table Run {}

table RunResult {
  result: Tensor;
}

table Sample {
  address: string;
  name: string;
  distribution: Distribution;
  control: bool = true;
  replace: bool = false;
}

table SampleResult {
  result: Tensor;
}

table Observe {
  address: string;
  name: string;
  distribution: Distribution;
  value: Tensor;
}

table ObserveResult {}

table Tag {
  address: string;
  name: string;
  value: Tensor;
}

table TagResult {}

table Forward {
  name: string;
  input: Tensor;
}

table ForwardResult {
  output: Tensor;
}

table Backward {
  name: string;
  input: Tensor;
  grad_output: Tensor;
}

table BackwardResult {
  grad_input: Tensor;
}

table BatchOperation {
  operations: [Message];
}

table BatchOperationResult {
  results: [Message];
}

table Reset {}

table Normal {
  mean: Tensor;
  stddev: Tensor;
}

table Uniform {
  low: Tensor;
  high: Tensor;
}

table Categorical {
  probs: Tensor;
}

table Poisson {
  rate: Tensor;
}

root_type Message;
file_identifier "PPXF";
